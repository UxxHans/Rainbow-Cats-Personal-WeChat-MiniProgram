<wxs module="util" src="../util.wxs" />

<view class="container empty" wx:if="{{allItems.length === 0}}">
  <image class="background" src="../../images/list/background.png" mode="aspectFit" />
  <view class="title">暂无商品</view>
  <view class="subtitle">有商品？赶紧派发！</view>
  <button class="btn-normal" hover-class="btn-hover" bindtap="toAddPage">添加新商品</button>
</view>

<view class="container" wx:if="{{allItems.length > 0}}">
  <image style="position: relative; height: 100%; width: 100%; top: 0;" mode="widthFix" src="../../images/Market/MarketCover.jpg"/>
  <button class="btn-small" hover-class="btn-hover" bindtap="toAddPage">添加新商品</button>
  <view class="form-group_label">
    已上架的商品
    <mp-badge content="{{unboughtItems.length}}" style="margin-left: 5px;" />
  </view>
  <view class="form-group" wx:if="{{unboughtItems.length > 0}}">
    <view class="form-cell" wx:for="{{unboughtItems}}" wx:key="index">
      <mp-slideview buttons="{{slideButtons}}" data-index='{{index}}' bindbuttontap="slideButtonTap">
        <view class="slide" data-index="{{index}}" bindtap="toDetailPage">
          <image class="checkbox" data-index='{{index}}' src="../../images/list/pending.png" catchtap="buyItem" />
          <view class="todo-info">
            <view class="todo-info_title">
              {{util.filterStr(item.title, 10)}}
              </view>
                <view class="todo-info_award">
                  {{item.price}} 积分
              </view>
            <view class="todo-info_desc">{{util.filterStr(item.desc, 10)}}</view>
          </view>
          <view class="todo-info_author">
            <image style="position: absolute; height: 100%; width: 100%; bottom: 0;"  wx:if="{{item._openid === kirbyOpenId}}" mode="widthFix" src="../../images/Mission/KirbyMission.png"/>
            <image style="position: absolute; height: 100%; width:100%; bottom: 0;" wx:if="{{item._openid === deeOpenId}}" mode="widthFix" src="../../images/Mission/DeeMission.png"/>
          </view>
          <image wx:if="{{item.star}}" class="star" src="../../images/list/star.png" />
        </view>
      </mp-slideview>
    </view>
  </view>
  <view class="form-group_label">
    已购买的商品
    <mp-badge content="{{boughtItems.length}}" style="margin-left: 5px;" />
  </view>
  <view class="form-group" wx:if="{{boughtItems.length > 0}}">
    <view class="form-cell" wx:for="{{boughtItems}}" wx:key="index">
      <mp-slideview buttons="{{slideButtons}}" data-index='{{index}}' bindbuttontap="slideButtonTapBottom">
        <view class="slide" data-index="{{index}}">
          <view class="todo-info">
            <view class="todo-info_title">
              {{util.filterStr(item.title, 10)}}
            </view>
            <view class="todo-info_award">
              {{item.price}} 积分
            </view>
            <view class="todo-info_desc">{{util.filterStr(item.desc, 10)}}</view>
          </view>
          <view class="todo-info_author">
              <image style="position: absolute;height: 100%; width:100%; bottom: 0;" wx:if="{{item._openid === kirbyOpenId}}" mode="widthFix" src="../../images/Mission/KirbyMission.png"/>
              <image style="position: absolute; height: 100%; width:100%; bottom: 0;" wx:if="{{item._openid === deeOpenId}}" mode="widthFix" src="../../images/Mission/DeeMission.png"/>
          </view>
          <image wx:if="{{item.star}}" class="star" src="../../images/list/star.png" />
        </view>
      </mp-slideview>
    </view>
  </view>
</view>